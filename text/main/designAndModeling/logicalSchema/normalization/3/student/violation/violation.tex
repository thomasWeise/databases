\hsection{Violation:~Non-Key Attribute Transitively Depends on Primary Key}%
\FloatBarrier%
%
\begin{figure}%
\centering%
%
\includegraphics[width=0.5\linewidth]{\currentDir/studentViolation3nf}%
%
\caption{A table which stores data about students and their parents in violation of the \pgls{3NF}, because the parent name depends on the parent phone number, which transitively depends on the student~ID.}%
\label{fig:studentViolation3nf}%
\end{figure}%
%
\gitExecSQLraw{normalization:3nf:student:violation:generated_sql:01_violation_database_2002}{}{normalization/3nf/student/violation/generated_sql}{01_violation_database_2002.sql}{}{}{}%
%
\gitLoadAndExecSQL{3nf:student:violation:03_public_student_table_5103}{}{normalization/3nf/student/violation/generated_sql}{03_public_student_table_5103.sql}{violation}{}{}%
\listingSQL{3nf:student:violation:03_public_student_table_5103}{%
The generated \sql\ code for creating the table \sqlil{student} that violates the \pgls{3NF} based on \cref{fig:studentViolation3nf}.}%
%
\gitLoadAndExecSQL{3nf:student:violation:insert}{}{normalization/3nf/student/violation}{insert.sql}{violation}{}{}%
\listingSQL{3nf:student:violation:insert}{%
Inserting some data into the table~\sqlil{student} in violation of the \pgls{3NF}.}%
%
\gitLoadAndExecSQL{3nf:student:violation:update}{}{normalization/3nf/student/violation}{update.sql}{violation}{}{}%
\listingSQLandOutput{3nf:student:violation:update}{%
We noticed that the name of the father of Mr.~Bibbo, Mr.~Bibotto, and Ms.~Bibboba is actually Mr.~B{\"o}dd{\"o}, not Mr.~Boddo. %
To change it, we need to touch three records, which is a typical update anomaly.%
}{}%
%
\gitExecSQLraw{normalization:3nf:student:violation:cleanup.sql}{}{normalization/3nf/student/violation}{cleanup.sql}{}{}{}%
%
In a first attempt, we again put all the data in one table.
In \cref{fig:studentViolation3nf}, we show a part of logical model which illustrates a \db\ table for storing information about students and their parents.
The table has four columns.
In the first column, we store the student~ID, which is the primary key.
The second column is the student name.
It is not a key and not necessarily unique.
For each student, we also store the name of one parent and their mobile phone number as a contact for emergencies.

This table is in the \pgls{1NF}, as there are neither compound attributes nor repeated groups.
It is also in the \pgls{2NF}, because there is no compound key and, hence, it is not possible that an attribute could depend on a part of such a key only.

However, this table violates the \pgls{3NF}.
The attribute \sqlil{parent_name} is functionally dependent on the attribute \sqlil{parent_mobile}.
We write this as~\funcDepb{\sqlil{parent_mobile}}{\sqlil{parent_name}}.
A mobile phone number is associated with a single person, hence there can only be one name for a given mobile phone number.

The parent mobile phone number depends on the primary key~\sqlil{student_id}.
This can be written as \funcDepb{\sqlil{student_id}}{\sqlil{parent_mobile}}.
The chain \funcDepb{\sqlil{student_id}}{\funcDepb{\sqlil{parent_mobile}}{\sqlil{parent_name}}} exists.

It obviously does not hold that \funcDepb{\sqlil{parent_mobile}}{\sqlil{student_id}}.
A parent could have multiple children who now study at our university.
Therefore, \cref{def:transitiveDependency} is fulfilled.
The relationship \funcDepb{\sqlil{student_id}}{\sqlil{parent_name}} is transitive.
And since it occurs in the table~\sqlil{student}, it violates the \pgls{3NF}.

Let us explore what consequences this has.
We first create the table by executing the script given in \cref{lst:3nf:student:violation:03_public_student_table_5103}.
The primary key \sqlil{student_id} be a string of exactly length~11~(\sqlil{CHARACTER(11)}\sqlIdx{CHARACTER}), because this is the length of our student~IDs.
The student name \sqlil{student_name} is a variable-length string of maximal length~100~(\sqlil{VARCHAR(100)}\sqlIdx{VARCHAR}).
The same holds for the name \sqlil{parent_name} of the parent.
The mobile phone number of the parent, \sqlil{parent_mobile}, is stored again stored as fixed-length string with length~11.
None of the four columns is optional, hence they are all marked as~\sqlilIdx{NOT NULL}.

Then we insert four student records into the \db\ using the script given in \cref{lst:3nf:student:violation:insert}.
There are four students, Mr.~Bibbo, Mr.~Bebbo, Mr.~Bibboto, and Ms.~Bibboba.
Their IDs are not important.
What is important is that Mr.~Bibbo, Mr.~Bibboto, and Ms.~Bibboba happen to be siblings.
Their proud father is Mr.~B{\"o}dd{\"o}.

Now it happened that, being located in China, the teacher in the administrative office did not really know how to enter the letter~\keys{\"o}.
So they chose, for the time being, to call the dad of the three kids simply \inQuotes{Mr.~Boddo}.
A few days later, they found a solution on how to enter the letter~\keys{\"o}.
They asked a German colleague to send them the letter via \pgls{wechat} and copy-pasted it into the system.
In order to fix the data, they created the script \cref{lst:3nf:student:violation:update}.

They use the mobile phone number~555\decSep444\decSep666\decSep77 of Mr.~B{\"o}dd{\"o} to identify him in the table.
To test this, they first use a \sqlilIdx{SELECT} statement to see whether they really get the corresponding rows and only the corresponding rows.
This works perfectly well, three student/parent name pairs associated with this mobile phone number are obtained.
The output of this command is as expected, so next they launch an \sqlilIdx{UPDATE} command.
The \sqlil{parent_name} is \sqlilIdx{SET} to~\sqlil{Böddö} for each record where \sqlil{parent_mobile = '55544466677'}.
The updated records are returned via the~\sqlilIdx{RETURNING} statement.
As we can see, the correct three rows are affected.

So to change one piece of information, three rows needed to be touched.
This is a classical example of an update anomaly.
Similarly, if we would delete the records of Mr.~Bibbo, Mr.~Bibboto, and Ms.~Bibboba, all the data about their dad would disappear as well.
Even worse, if we would want to delete one parent from the dataset, e.g., Mr.~Böddö, then the data of all their student children would be removed as well.
That would be an deletion anomaly.
Finally, since we cannot insert the data of a student without also inserting data about a parent and vice versa.
That would be an insertion anomaly.

And of course we also have redundancy again.
The data of Mr.~Böddö is stored three times.
It can be said that this redundancy causes the update anomaly.
And it means that we again need to enter the same information several times.
This very much increases the probability of typos and other errors that could lead to data inconsistency.

For example, it could have well been possible that the information about the students were entered by different teachers.
Then, maybe one teacher would know how to enter an~\keys{\"o} while another one would just use an~\keys{o}.
And baam, our data would be inconsistent, as we would have same parent with two different names in our system.%
%
\FloatBarrier%
\endhsection%
%
